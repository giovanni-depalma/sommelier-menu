---
import Layout from "../layouts/Layout.astro";
import menu from "../data/menu";
import wines from "../data/wines";

import QRCode from "qrcode";

function getWineName(id: string) {
    const wine = wines.find((w) => w.id === id);
    return wine ? `${wine.name} (${wine.producer})` : "Chiedi al Sommelier";
}

const fullUrl = new URL(Astro.url.pathname, Astro.site).href;
const qrCodeUrl = await QRCode.toDataURL(fullUrl, { width: 150 });
---

<Layout title="Menu - Restaurante Fusi√≥n">
    <header class="page-header">
        <h1>Menu</h1>
        <a href={import.meta.env.BASE_URL} class="back-link"
            >‚Üê Torna alla Home</a
        >
        <a
            href={`${import.meta.env.BASE_URL}/menu.pdf`}
            class="back-link"
            download>üìÑ Scarica PDF</a
        >
    </header>

    <div class="print-only qr-code-header">
        <img src={qrCodeUrl} alt="QR Code Menu" />
        <p>Scansiona per vedere il menu online</p>
    </div>

    <div class="content-container" id="menu-container">
        {
            menu.map((category) => (
                <section class="category-section">
                    <h2 class="category-title">{category.category}</h2>
                    {category.items.map((item) => (
                        <div class="item-card">
                            <div class="item-info">
                                <div class="item-header">
                                    <h3 class="item-name">{item.name}</h3>
                                    <span class="item-price">
                                        ‚Ç¨ {item.price}
                                    </span>
                                </div>
                                <p class="item-desc">{item.description}</p>
                                <p class="wine-pairing">
                                    <span class="pairing-label">
                                        Abbinamenti:
                                    </span>
                                    <a
                                        href={`${import.meta.env.BASE_URL}/pairing/${item.id}`}
                                        class="pairing-link"
                                    >
                                        <span class="pairing-line">
                                            <span class="flag">üá™üá∏</span>{" "}
                                            {getWineName(
                                                item.pairingSpanish.wineId,
                                            )}
                                        </span>
                                        <span class="pairing-line">
                                            <span class="flag">üáÆüáπ</span>{" "}
                                            {getWineName(
                                                item.pairingItalian.wineId,
                                            )}
                                        </span>
                                        <span class="info-text">
                                            Scopri l'abbinamento ‚ÑπÔ∏è
                                        </span>
                                    </a>
                                </p>
                            </div>
                        </div>
                    ))}
                </section>
            ))
        }
    </div>
</Layout>

<style>
    .pairing-link {
        color: inherit;
        text-decoration: none;
        border-bottom: 1px dotted currentColor;
        transition: all 0.2s;
    }

    .pairing-link:hover {
        color: #000;
        border-bottom: 1px solid #000;
    }

    .info-icon {
        font-size: 0.8em;
        vertical-align: middle;
        opacity: 0.7;
    }

    .pairing-line {
        display: block;
        margin-top: 0.3rem;
    }

    .flag {
        font-size: 1.1em;
        margin-right: 0.3rem;
    }

    .info-text {
        font-size: 0.8em;
        color: #666;
        display: block;
        margin-top: 0.5rem;
        font-style: italic;
        text-align: right;
    }

    .pairing-label {
        font-weight: 600;
        display: block;
        margin-bottom: 0.2rem;
        color: #888;
        font-size: 0.9em;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    @media print {
        .info-icon,
        .info-text {
            display: none;
        }

        .pairing-link {
            text-decoration: none;
            border-bottom: none;
        }
    }
</style>
